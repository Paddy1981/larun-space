<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Terminal - Larun. AstroTinyML</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" type="image/svg+xml" href="../assets/logo.svg">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --black: #202124;
            --dark-gray: #3c4043;
            --medium-gray: #5f6368;
            --light-gray: #dadce0;
            --lighter-gray: #f1f3f4;
            --white: #ffffff;
            --terminal-bg: #1e1e1e;
            --terminal-text: #d4d4d4;
            --terminal-green: #4ec9b0;
            --terminal-blue: #569cd6;
            --terminal-yellow: #dcdcaa;
            --terminal-red: #f14c4c;
            --terminal-purple: #c586c0;
            --terminal-cyan: #9cdcfe;
            --border-radius: 8px;
            --shadow: 0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
        }
        body {
            font-family: 'Google Sans', 'Roboto', sans-serif;
            background: var(--black);
            color: var(--white);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .top-nav {
            height: 48px;
            background: var(--dark-gray);
            border-bottom: 1px solid #444;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
        }
        .nav-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .back-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            color: var(--light-gray);
            font-size: 13px;
            padding: 6px 12px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        .back-btn:hover { background: rgba(255,255,255,0.1); }
        .logo-text {
            font-size: 16px;
            font-weight: 500;
            color: var(--white);
        }
        .logo-text span { color: var(--terminal-green); }
        .nav-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .nav-btn {
            padding: 6px 12px;
            border: 1px solid #555;
            border-radius: 4px;
            background: transparent;
            color: var(--light-gray);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        .nav-btn:hover { background: rgba(255,255,255,0.1); border-color: #777; }
        .nav-btn.active { background: var(--terminal-green); color: var(--black); border-color: var(--terminal-green); }
        .terminal-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        .sidebar {
            width: 280px;
            background: #252526;
            border-right: 1px solid #444;
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            padding: 12px 16px;
            border-bottom: 1px solid #444;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--medium-gray);
        }
        .command-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }
        .command-category {
            padding: 8px 16px 4px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--terminal-green);
        }
        .command-item {
            padding: 8px 16px;
            cursor: pointer;
            font-family: 'Roboto Mono', monospace;
            font-size: 12px;
            color: var(--light-gray);
            transition: background 0.2s;
        }
        .command-item:hover { background: rgba(255,255,255,0.05); }
        .command-item code {
            color: var(--terminal-cyan);
        }
        .command-item .desc {
            font-size: 10px;
            color: var(--medium-gray);
            margin-top: 2px;
            font-family: 'Google Sans', sans-serif;
        }
        .main-terminal {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--terminal-bg);
        }
        .terminal-tabs {
            display: flex;
            background: #252526;
            border-bottom: 1px solid #444;
        }
        .terminal-tab {
            padding: 8px 16px;
            font-size: 12px;
            color: var(--light-gray);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .terminal-tab:hover { background: rgba(255,255,255,0.05); }
        .terminal-tab.active {
            color: var(--white);
            border-bottom-color: var(--terminal-green);
        }
        .terminal-tab .close {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
        }
        .terminal-tab:hover .close { opacity: 0.5; }
        .terminal-tab .close:hover { opacity: 1; background: rgba(255,255,255,0.1); }
        .terminal-output {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        .output-line {
            margin-bottom: 4px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .output-line.command { color: var(--terminal-cyan); }
        .output-line.success { color: var(--terminal-green); }
        .output-line.error { color: var(--terminal-red); }
        .output-line.warning { color: var(--terminal-yellow); }
        .output-line.info { color: var(--terminal-blue); }
        .output-line.system { color: var(--terminal-purple); }
        .prompt {
            color: var(--terminal-green);
        }
        .terminal-input-wrapper {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: #252526;
            border-top: 1px solid #444;
        }
        .terminal-prompt {
            color: var(--terminal-green);
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            margin-right: 8px;
        }
        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--terminal-text);
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            outline: none;
        }
        .terminal-input::placeholder { color: var(--medium-gray); }
        .status-bar {
            height: 24px;
            background: var(--terminal-green);
            color: var(--black);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            font-size: 11px;
        }
        .status-left, .status-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .status-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .table-output {
            margin: 8px 0;
            border-collapse: collapse;
            width: 100%;
        }
        .table-output th, .table-output td {
            padding: 4px 12px;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        .table-output th {
            color: var(--terminal-green);
            font-weight: 500;
        }
        .progress-bar {
            width: 200px;
            height: 4px;
            background: #444;
            border-radius: 2px;
            overflow: hidden;
            margin: 4px 0;
        }
        .progress-fill {
            height: 100%;
            background: var(--terminal-green);
            transition: width 0.3s;
        }
        .ascii-art {
            color: var(--terminal-green);
            white-space: pre;
            font-size: 10px;
            line-height: 1.2;
        }
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .terminal-container { flex-direction: column; }
        }
    </style>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-left">
            <a href="../dashboard.html" class="back-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                Dashboard
            </a>
            <span class="logo-text">Larun<span>.</span> Web Terminal</span>
        </div>
        <div class="nav-right">
            <button class="nav-btn" onclick="clearTerminal()">Clear</button>
            <button class="nav-btn" onclick="showHelp()">Help</button>
            <button class="nav-btn active" id="connection-status">Connected</button>
        </div>
    </nav>

    <div class="terminal-container">
        <aside class="sidebar">
            <div class="sidebar-header">Commands</div>
            <div class="command-list">
                <div class="command-category">Detection</div>
                <div class="command-item" onclick="insertCommand('larun detect --target TIC_ID')">
                    <code>larun detect</code>
                    <div class="desc">Run transit detection on a target</div>
                </div>
                <div class="command-item" onclick="insertCommand('larun scan --sector 45')">
                    <code>larun scan</code>
                    <div class="desc">Batch scan multiple targets</div>
                </div>
                <div class="command-item" onclick="insertCommand('larun search --ra 180 --dec 45')">
                    <code>larun search</code>
                    <div class="desc">Search by coordinates</div>
                </div>

                <div class="command-category">Pipeline</div>
                <div class="command-item" onclick="insertCommand('larun ingest --source MAST')">
                    <code>larun ingest</code>
                    <div class="desc">Ingest data from archives</div>
                </div>
                <div class="command-item" onclick="insertCommand('larun pipeline status')">
                    <code>larun pipeline</code>
                    <div class="desc">Check pipeline status</div>
                </div>

                <div class="command-category">Calibration</div>
                <div class="command-item" onclick="insertCommand('larun calibrate --auto')">
                    <code>larun calibrate</code>
                    <div class="desc">Run model calibration</div>
                </div>
                <div class="command-item" onclick="insertCommand('larun validate --model default')">
                    <code>larun validate</code>
                    <div class="desc">Validate model accuracy</div>
                </div>

                <div class="command-category">Vetting</div>
                <div class="command-item" onclick="insertCommand('larun vet --candidate TIC_ID')">
                    <code>larun vet</code>
                    <div class="desc">Run false positive tests</div>
                </div>

                <div class="command-category">Reports</div>
                <div class="command-item" onclick="insertCommand('larun report --format pdf')">
                    <code>larun report</code>
                    <div class="desc">Generate NASA report</div>
                </div>
                <div class="command-item" onclick="insertCommand('larun export --format fits')">
                    <code>larun export</code>
                    <div class="desc">Export data files</div>
                </div>

                <div class="command-category">Model</div>
                <div class="command-item" onclick="insertCommand('larun model info')">
                    <code>larun model info</code>
                    <div class="desc">View loaded model details</div>
                </div>
                <div class="command-item" onclick="insertCommand('larun model benchmark')">
                    <code>larun model benchmark</code>
                    <div class="desc">Run performance benchmark</div>
                </div>
                <div class="command-item" onclick="insertCommand('larun model predict --input sample')">
                    <code>larun model predict</code>
                    <div class="desc">Run inference on input</div>
                </div>
                <div class="command-item" onclick="insertCommand('larun model classes')">
                    <code>larun model classes</code>
                    <div class="desc">List classification classes</div>
                </div>

                <div class="command-category">System</div>
                <div class="command-item" onclick="insertCommand('larun status')">
                    <code>larun status</code>
                    <div class="desc">System status overview</div>
                </div>
                <div class="command-item" onclick="insertCommand('larun config')">
                    <code>larun config</code>
                    <div class="desc">View/edit configuration</div>
                </div>
                <div class="command-item" onclick="insertCommand('larun help')">
                    <code>larun help</code>
                    <div class="desc">Show all commands</div>
                </div>
            </div>
        </aside>

        <main class="main-terminal">
            <div class="terminal-tabs">
                <div class="terminal-tab active">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8h16v10zm-9-6l-4 4 1.4 1.4L11 10.8l2.6 2.6L15 12l-4-4z"/>
                    </svg>
                    Terminal 1
                    <span class="close">×</span>
                </div>
            </div>

            <div class="terminal-output" id="terminal-output">
                <!-- Output will be rendered here -->
            </div>

            <div class="terminal-input-wrapper">
                <span class="terminal-prompt">larun@web:~$</span>
                <input type="text" class="terminal-input" id="terminal-input"
                    placeholder="Type a command or 'help' for options..."
                    autocomplete="off" autofocus>
            </div>
        </main>
    </div>

    <div class="status-bar">
        <div class="status-left">
            <span class="status-item">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                TinyML Engine Ready
            </span>
            <span class="status-item" id="status-model">Model: v1.0.3</span>
        </div>
        <div class="status-right">
            <span class="status-item" id="status-tier">Explorer Tier</span>
            <span class="status-item" id="status-usage">0/10 targets today</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/auth.js"></script>
    <script>
        const output = document.getElementById('terminal-output');
        const input = document.getElementById('terminal-input');
        let commandHistory = [];
        let historyIndex = -1;
        let currentUsage = 0;

        // ASCII art banner
        const banner = `
  _
 | |    __ _ _ __ _   _ _ __
 | |   / _\` | '__| | | | '_ \\
 | |__| (_| | |  | |_| | | | |
 |_____\\__,_|_|   \\__,_|_| |_|

  AstroTinyML Web Terminal v1.0
  Type 'help' for available commands
────────────────────────────────────────`;

        // Initialize terminal
        function initTerminal() {
            printLine(banner, 'ascii-art');
            printLine('');
            printLine('Initializing TinyML engine...', 'system');
            setTimeout(() => {
                printLine('Loading spectral CNN model (96KB)...', 'system');
            }, 300);
            setTimeout(() => {
                printLine('Model loaded successfully.', 'success');
                printLine('Connected to NASA MAST archive.', 'info');
                printLine('');
                printLine('Ready for commands. All processing runs on-device.', 'info');
                printLine('');
            }, 800);

            // Update status based on auth
            setTimeout(() => {
                const tier = localStorage.getItem('user_tier') || 'free';
                const tierNames = { free: 'Explorer', researcher: 'Researcher', scientist: 'Scientist' };
                document.getElementById('status-tier').textContent = tierNames[tier] + ' Tier';

                const limits = { free: 10, researcher: 1000, scientist: -1 };
                const limit = limits[tier];
                document.getElementById('status-usage').textContent = limit === -1 ? 'Unlimited' : `0/${limit} targets today`;
            }, 100);
        }

        // Print line to terminal
        function printLine(text, className = '') {
            const line = document.createElement('div');
            line.className = 'output-line' + (className ? ' ' + className : '');
            if (className === 'ascii-art') {
                line.innerHTML = text;
            } else {
                line.textContent = text;
            }
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        // Print table
        function printTable(headers, rows) {
            const table = document.createElement('table');
            table.className = 'table-output';

            const headerRow = document.createElement('tr');
            headers.forEach(h => {
                const th = document.createElement('th');
                th.textContent = h;
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            rows.forEach(row => {
                const tr = document.createElement('tr');
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    td.style.color = '#d4d4d4';
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });

            output.appendChild(table);
            output.scrollTop = output.scrollHeight;
        }

        // Command handlers
        const commands = {
            help: () => {
                printLine('');
                printLine('LARUN ASTROTML COMMANDS', 'info');
                printLine('══════════════════════════════════════════════════════════════', 'info');
                printLine('');
                printLine('DETECTION:', 'success');
                printLine('  detect --target <TIC_ID>    Run transit detection on target');
                printLine('  scan --sector <N>           Batch scan TESS sector');
                printLine('  search --ra <RA> --dec <DEC>  Search by coordinates');
                printLine('');
                printLine('PIPELINE:', 'success');
                printLine('  ingest --source <MAST|TESS|Kepler>  Ingest archive data');
                printLine('  pipeline status             Check pipeline status');
                printLine('');
                printLine('CALIBRATION:', 'success');
                printLine('  calibrate --auto            Auto-calibrate with NASA archive');
                printLine('  validate --model <name>     Validate model accuracy');
                printLine('');
                printLine('VETTING:', 'success');
                printLine('  vet --candidate <TIC_ID>    Run false positive tests');
                printLine('');
                printLine('REPORTS:', 'success');
                printLine('  report --format <pdf|json>  Generate NASA report');
                printLine('  export --format <fits|csv>  Export data');
                printLine('');
                printLine('SYSTEM:', 'success');
                printLine('  status                      System status overview');
                printLine('  config                      View configuration');
                printLine('  clear                       Clear terminal');
                printLine('  help                        Show this help');
                printLine('');
            },

            detect: (args) => {
                const target = args.find(a => a.startsWith('--target'))?.split('=')[1] ||
                              args[args.indexOf('--target') + 1] || 'TIC 307210830';

                printLine(`Analyzing target: ${target}`, 'info');
                printLine('');

                // Simulate processing
                setTimeout(() => {
                    printLine('Fetching light curve from MAST...', 'system');
                }, 200);
                setTimeout(() => {
                    printLine('Preprocessing: detrending, normalizing...', 'system');
                }, 600);
                setTimeout(() => {
                    printLine('Running BLS periodogram search...', 'system');
                }, 1000);
                setTimeout(() => {
                    printLine('TinyML CNN inference...', 'system');
                }, 1400);
                setTimeout(() => {
                    printLine('');
                    printLine('═══════════════════════════════════════════════════════════════', 'success');
                    printLine('                    DETECTION RESULTS                           ', 'success');
                    printLine('═══════════════════════════════════════════════════════════════', 'success');
                    printLine('');
                    printTable(
                        ['Parameter', 'Value'],
                        [
                            ['Target', target],
                            ['Period', '4.23 days'],
                            ['Depth', '0.85%'],
                            ['Duration', '3.2 hours'],
                            ['SNR', '12.4'],
                            ['Classification', 'Hot Jupiter'],
                            ['Confidence', '94.2%'],
                            ['False Positive Prob', '3.1%']
                        ]
                    );
                    printLine('');
                    printLine('Transit signal detected with high confidence.', 'success');
                    printLine('Recommended: Run vetting tests with `larun vet --candidate ' + target + '`', 'info');
                    printLine('');

                    currentUsage++;
                    updateUsage();
                }, 2000);
            },

            status: () => {
                printLine('');
                printLine('SYSTEM STATUS', 'info');
                printLine('════════════════════════════════════════════════════════════════', 'info');
                printLine('');
                printTable(
                    ['Component', 'Status', 'Details'],
                    [
                        ['TinyML Engine', 'Online', 'v1.0.3, 96KB model loaded'],
                        ['MAST Connection', 'Connected', 'Latency: 45ms'],
                        ['Pipeline', 'Idle', 'Last run: 2 hours ago'],
                        ['Model Accuracy', '96.2%', 'Calibrated 2h ago'],
                        ['API Status', 'Healthy', '247/1000 requests this month']
                    ]
                );
                printLine('');
                printLine('All systems operational.', 'success');
                printLine('');
            },

            calibrate: (args) => {
                printLine('Starting auto-calibration...', 'info');
                printLine('');

                setTimeout(() => printLine('Fetching confirmed exoplanets from NASA archive...', 'system'), 200);
                setTimeout(() => printLine('Downloaded 5,500+ reference targets.', 'system'), 800);
                setTimeout(() => printLine('Running validation pass 1/3...', 'system'), 1200);
                setTimeout(() => printLine('Running validation pass 2/3...', 'system'), 1800);
                setTimeout(() => printLine('Running validation pass 3/3...', 'system'), 2400);
                setTimeout(() => {
                    printLine('');
                    printLine('Calibration complete!', 'success');
                    printTable(
                        ['Metric', 'Before', 'After'],
                        [
                            ['Accuracy', '95.8%', '96.2%'],
                            ['Precision', '94.1%', '94.8%'],
                            ['Recall', '96.5%', '97.1%'],
                            ['F1 Score', '0.952', '0.959']
                        ]
                    );
                    printLine('');
                    printLine('Model calibration saved.', 'success');
                    printLine('');
                }, 3000);
            },

            vet: (args) => {
                const candidate = args.find(a => a.startsWith('--candidate'))?.split('=')[1] ||
                                 args[args.indexOf('--candidate') + 1] || 'TIC 307210830 b';

                printLine(`Running vetting tests for ${candidate}...`, 'info');
                printLine('');

                setTimeout(() => {
                    printLine('Test 1/4: Odd/Even Depth Test...', 'system');
                }, 200);
                setTimeout(() => {
                    printLine('  PASS - Odd: 0.847%, Even: 0.852%, Diff: 0.6%', 'success');
                }, 600);
                setTimeout(() => {
                    printLine('Test 2/4: Secondary Eclipse Search...', 'system');
                }, 800);
                setTimeout(() => {
                    printLine('  PASS - No secondary eclipse detected', 'success');
                }, 1200);
                setTimeout(() => {
                    printLine('Test 3/4: V-Shape Analysis...', 'system');
                }, 1400);
                setTimeout(() => {
                    printLine('  PASS - U-shaped transit (planetary)', 'success');
                }, 1800);
                setTimeout(() => {
                    printLine('Test 4/4: Duration Consistency...', 'system');
                }, 2000);
                setTimeout(() => {
                    printLine('  MARGINAL - Duration within expected range', 'warning');
                }, 2400);
                setTimeout(() => {
                    printLine('');
                    printLine('═══════════════════════════════════════════════════════════════', 'success');
                    printLine('VETTING SUMMARY', 'success');
                    printLine('═══════════════════════════════════════════════════════════════', 'success');
                    printLine('');
                    printLine(`Candidate: ${candidate}`, 'info');
                    printLine('Planet Probability: 92%', 'success');
                    printLine('Tests Passed: 3/4', 'info');
                    printLine('');
                    printLine('Recommendation: LIKELY PLANET', 'success');
                    printLine('');
                }, 2800);
            },

            pipeline: (args) => {
                if (args.includes('status')) {
                    printLine('');
                    printLine('PIPELINE STATUS', 'info');
                    printLine('════════════════════════════════════════════════════════════════', 'info');
                    printTable(
                        ['Source', 'Status', 'Last Sync', 'Objects'],
                        [
                            ['MAST', 'Connected', '10 min ago', '2,847'],
                            ['TESS', 'Connected', '30 min ago', '1,456'],
                            ['Kepler', 'Connected', '2 hours ago', '891']
                        ]
                    );
                    printLine('');
                    printLine('Pipeline is healthy. No jobs in queue.', 'success');
                    printLine('');
                } else {
                    printLine('Usage: pipeline status', 'warning');
                }
            },

            ingest: (args) => {
                const source = args.find(a => a.startsWith('--source'))?.split('=')[1] ||
                              args[args.indexOf('--source') + 1] || 'MAST';

                printLine(`Connecting to ${source} archive...`, 'info');
                setTimeout(() => printLine(`Authenticated with ${source}.`, 'success'), 400);
                setTimeout(() => printLine('Fetching available datasets...', 'system'), 800);
                setTimeout(() => printLine('Found 247 new light curves.', 'info'), 1400);
                setTimeout(() => {
                    printLine('Downloading and preprocessing...', 'system');

                    // Progress simulation
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += Math.random() * 15;
                        if (progress >= 100) {
                            progress = 100;
                            clearInterval(interval);
                            printLine('');
                            printLine(`Successfully ingested 247 targets from ${source}.`, 'success');
                            printLine('');
                        }
                    }, 300);
                }, 1800);
            },

            report: (args) => {
                const format = args.find(a => a.startsWith('--format'))?.split('=')[1] ||
                              args[args.indexOf('--format') + 1] || 'pdf';

                printLine(`Generating NASA-compatible report (${format.toUpperCase()})...`, 'info');
                setTimeout(() => printLine('Compiling detection results...', 'system'), 300);
                setTimeout(() => printLine('Adding vetting analysis...', 'system'), 700);
                setTimeout(() => printLine('Formatting for NASA submission...', 'system'), 1100);
                setTimeout(() => {
                    printLine('');
                    printLine(`Report generated: larun_report_2026-02-02.${format}`, 'success');
                    printLine('');
                    printLine('Report includes:', 'info');
                    printLine('  - Detection summary for 3 candidates', 'info');
                    printLine('  - Vetting results and diagnostics', 'info');
                    printLine('  - Light curve plots', 'info');
                    printLine('  - NASA submission metadata', 'info');
                    printLine('');
                }, 1500);
            },

            config: () => {
                printLine('');
                printLine('CONFIGURATION', 'info');
                printLine('════════════════════════════════════════════════════════════════', 'info');
                printTable(
                    ['Setting', 'Value'],
                    [
                        ['Default Output', 'PDF'],
                        ['SNR Threshold', '7.0'],
                        ['Auto-vet', 'Enabled'],
                        ['Data Sources', 'MAST, TESS, Kepler'],
                        ['Model Version', 'v1.0.3'],
                        ['Quantization', 'INT8'],
                        ['Processing', 'On-device']
                    ]
                );
                printLine('');
                printLine('Edit settings at: Dashboard > Profile > Settings', 'info');
                printLine('');
            },

            scan: (args) => {
                const sector = args.find(a => a.startsWith('--sector'))?.split('=')[1] ||
                              args[args.indexOf('--sector') + 1] || '45';

                printLine(`Initiating batch scan of TESS Sector ${sector}...`, 'info');
                printLine('');

                setTimeout(() => printLine('Querying MAST for sector targets...', 'system'), 300);
                setTimeout(() => printLine('Found 1,247 targets in sector.', 'info'), 800);
                setTimeout(() => printLine('Beginning parallel analysis (batch size: 50)...', 'system'), 1200);
                setTimeout(() => printLine('Processing batch 1/25...', 'system'), 1800);
                setTimeout(() => printLine('Processing batch 5/25...', 'system'), 2400);
                setTimeout(() => printLine('Processing batch 15/25...', 'system'), 3000);
                setTimeout(() => printLine('Processing batch 25/25...', 'system'), 3600);
                setTimeout(() => {
                    printLine('');
                    printLine('═══════════════════════════════════════════════════════════════', 'success');
                    printLine('BATCH SCAN COMPLETE', 'success');
                    printLine('═══════════════════════════════════════════════════════════════', 'success');
                    printTable(
                        ['Metric', 'Value'],
                        [
                            ['Targets Processed', '1,247'],
                            ['Detections', '23'],
                            ['High Confidence (>90%)', '8'],
                            ['Processing Time', '4.2 seconds'],
                            ['Avg Time/Target', '3.4 ms']
                        ]
                    );
                    printLine('');
                    printLine('8 high-confidence candidates require vetting.', 'success');
                    printLine('');
                }, 4200);
            },

            search: (args) => {
                const ra = args.find(a => a.startsWith('--ra'))?.split('=')[1] || '180.0';
                const dec = args.find(a => a.startsWith('--dec'))?.split('=')[1] || '45.0';

                printLine(`Searching targets near RA=${ra}, Dec=${dec}...`, 'info');
                setTimeout(() => {
                    printLine('');
                    printTable(
                        ['TIC ID', 'Distance', 'Tmag', 'Status'],
                        [
                            ['TIC 307210830', '0.5°', '11.2', 'Has detections'],
                            ['TIC 441462736', '1.2°', '10.8', 'Confirmed planet'],
                            ['TIC 892744521', '2.1°', '12.4', 'EB flagged'],
                            ['TIC 156789012', '2.8°', '9.7', 'Unprocessed']
                        ]
                    );
                    printLine('');
                    printLine('4 targets found within 3° radius.', 'info');
                    printLine('');
                }, 800);
            },

            clear: () => {
                output.innerHTML = '';
                printLine('Terminal cleared.', 'system');
                printLine('');
            },

            export: (args) => {
                const format = args.find(a => a.startsWith('--format'))?.split('=')[1] || 'fits';
                printLine(`Exporting data as ${format.toUpperCase()}...`, 'info');
                setTimeout(() => {
                    printLine(`Exported: larun_data_export.${format}`, 'success');
                    printLine('File ready for download.', 'info');
                    printLine('');
                }, 1000);
            },

            validate: (args) => {
                printLine('Running model validation against test set...', 'info');
                setTimeout(() => {
                    printLine('');
                    printTable(
                        ['Metric', 'Score'],
                        [
                            ['Accuracy', '96.2%'],
                            ['Precision', '94.8%'],
                            ['Recall', '97.1%'],
                            ['F1 Score', '0.959'],
                            ['AUC-ROC', '0.983']
                        ]
                    );
                    printLine('');
                    printLine('Model validation passed all benchmarks.', 'success');
                    printLine('');
                }, 1500);
            },

            model: (args) => {
                const subcommand = args[0] || 'info';

                if (subcommand === 'info') {
                    printLine('');
                    printLine('TINYML MODEL INFORMATION', 'info');
                    printLine('════════════════════════════════════════════════════════════════', 'info');
                    printTable(
                        ['Property', 'Value'],
                        [
                            ['Model Name', 'Larun Spectral CNN v1.0.3'],
                            ['Architecture', '1D CNN + Dense'],
                            ['Input Shape', '(1, 2048)'],
                            ['Output Classes', '6'],
                            ['Parameters', '24,576'],
                            ['Model Size', '96 KB'],
                            ['Quantization', 'INT8'],
                            ['Framework', 'TensorFlow Lite Micro'],
                            ['Target', 'Edge/On-device'],
                            ['Accuracy', '96.2%'],
                            ['Inference Time', '<10ms']
                        ]
                    );
                    printLine('');
                    printLine('Model optimized for microcontroller deployment.', 'info');
                    printLine('');
                } else if (subcommand === 'benchmark') {
                    printLine('Running model benchmark...', 'info');
                    printLine('');

                    setTimeout(() => printLine('Warming up inference engine...', 'system'), 200);
                    setTimeout(() => printLine('Running 100 inference iterations...', 'system'), 600);
                    setTimeout(() => {
                        printLine('');
                        printLine('BENCHMARK RESULTS', 'success');
                        printLine('════════════════════════════════════════════════════════════════', 'success');
                        printTable(
                            ['Metric', 'Value'],
                            [
                                ['Iterations', '100'],
                                ['Total Time', '823ms'],
                                ['Mean Inference', '8.23ms'],
                                ['Min Inference', '6.1ms'],
                                ['Max Inference', '12.4ms'],
                                ['Std Dev', '1.2ms'],
                                ['Throughput', '121 inferences/sec'],
                                ['Memory Peak', '84 MB']
                            ]
                        );
                        printLine('');
                        printLine('Benchmark complete. Model performs within specifications.', 'success');
                        printLine('');
                    }, 1500);
                } else if (subcommand === 'predict') {
                    const inputType = args.find(a => a.startsWith('--input'))?.split('=')[1] ||
                                     args[args.indexOf('--input') + 1] || 'sample';

                    printLine(`Running inference on ${inputType} data...`, 'info');
                    printLine('');

                    setTimeout(() => printLine('Preprocessing input...', 'system'), 200);
                    setTimeout(() => printLine('Normalizing spectral data...', 'system'), 400);
                    setTimeout(() => printLine('Running TinyML inference...', 'system'), 600);
                    setTimeout(() => {
                        printLine('');
                        printLine('PREDICTION RESULTS', 'success');
                        printLine('════════════════════════════════════════════════════════════════', 'success');
                        printLine('');
                        printLine('Class Probabilities:', 'info');
                        printTable(
                            ['Class', 'Probability', 'Confidence'],
                            [
                                ['Hot Jupiter', '0.412', '████████░░'],
                                ['Warm Neptune', '0.234', '████░░░░░░'],
                                ['Super-Earth', '0.187', '███░░░░░░░'],
                                ['Mini-Neptune', '0.098', '█░░░░░░░░░'],
                                ['Terrestrial', '0.045', '░░░░░░░░░░'],
                                ['Gas Giant', '0.024', '░░░░░░░░░░']
                            ]
                        );
                        printLine('');
                        printLine('Predicted Class: Hot Jupiter (41.2% confidence)', 'success');
                        printLine('Transit Detection: Significant (SNR: 9.8)', 'success');
                        printLine('Inference Time: 7.2ms', 'info');
                        printLine('');
                    }, 1000);
                } else if (subcommand === 'classes') {
                    printLine('');
                    printLine('MODEL CLASSIFICATION CLASSES', 'info');
                    printLine('════════════════════════════════════════════════════════════════', 'info');
                    printTable(
                        ['Class ID', 'Name', 'Description', 'Training Samples'],
                        [
                            ['0', 'Hot Jupiter', 'Gas giant, P < 10d, close orbit', '1,247'],
                            ['1', 'Warm Neptune', 'Ice giant, 10d < P < 100d', '892'],
                            ['2', 'Super-Earth', 'Rocky, 1.25-2 R⊕', '1,456'],
                            ['3', 'Mini-Neptune', 'Small gas, 2-4 R⊕', '634'],
                            ['4', 'Terrestrial', 'Earth-like, < 1.25 R⊕', '423'],
                            ['5', 'Gas Giant', 'Jupiter-like, P > 100d', '348']
                        ]
                    );
                    printLine('');
                    printLine('Total training samples: 5,000', 'info');
                    printLine('Validation set: 500 samples', 'info');
                    printLine('');
                } else {
                    printLine('Available model commands:', 'info');
                    printLine('  model info       - View model details', 'info');
                    printLine('  model benchmark  - Run performance test', 'info');
                    printLine('  model predict    - Run inference', 'info');
                    printLine('  model classes    - List output classes', 'info');
                    printLine('');
                }
            }
        };

        // Process command
        function processCommand(cmd) {
            const trimmed = cmd.trim();
            if (!trimmed) return;

            // Add to history
            commandHistory.push(trimmed);
            historyIndex = commandHistory.length;

            // Print command
            printLine(`larun@web:~$ ${trimmed}`, 'command');

            // Parse command
            const parts = trimmed.split(/\s+/);
            let command = parts[0];
            const args = parts.slice(1);

            // Handle 'larun' prefix
            if (command === 'larun') {
                command = args[0];
                args.shift();
            }

            // Execute command
            if (commands[command]) {
                commands[command](args);
            } else if (trimmed === '') {
                // Empty line
            } else {
                printLine(`Command not found: ${command}`, 'error');
                printLine("Type 'help' for available commands.", 'info');
                printLine('');
            }
        }

        // Update usage counter
        function updateUsage() {
            const tier = localStorage.getItem('user_tier') || 'free';
            const limits = { free: 10, researcher: 1000, scientist: -1 };
            const limit = limits[tier];

            if (limit === -1) {
                document.getElementById('status-usage').textContent = 'Unlimited';
            } else {
                document.getElementById('status-usage').textContent = `${currentUsage}/${limit} targets today`;

                if (currentUsage >= limit) {
                    printLine('');
                    printLine('Daily target limit reached. Upgrade for more targets.', 'warning');
                    printLine('');
                }
            }
        }

        // Insert command into input
        function insertCommand(cmd) {
            input.value = cmd;
            input.focus();
        }

        // Clear terminal
        function clearTerminal() {
            output.innerHTML = '';
            printLine('Terminal cleared.', 'system');
            printLine('');
        }

        // Show help
        function showHelp() {
            commands.help();
        }

        // Input handling
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                processCommand(input.value);
                input.value = '';
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    input.value = commandHistory[historyIndex];
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    input.value = commandHistory[historyIndex];
                } else {
                    historyIndex = commandHistory.length;
                    input.value = '';
                }
            } else if (e.key === 'Tab') {
                e.preventDefault();
                // Simple tab completion
                const val = input.value.trim();
                const cmds = Object.keys(commands);
                const match = cmds.find(c => c.startsWith(val.replace('larun ', '')));
                if (match) {
                    input.value = 'larun ' + match + ' ';
                }
            }
        });

        // Keep focus on input
        document.addEventListener('click', () => {
            input.focus();
        });

        // Initialize
        initTerminal();
    </script>
</body>
</html>
