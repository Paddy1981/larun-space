<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Larun Pricing - Choose your plan for exoplanet detection">
    <title>Pricing - Larun.</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="assets/logo.svg">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --black: #202124; --dark-gray: #3c4043; --medium-gray: #5f6368;
            --light-gray: #dadce0; --lighter-gray: #f1f3f4; --white: #ffffff;
            --primary: #1a73e8; --primary-light: #e8f0fe;
            --success: #137333; --success-light: #e6f4ea;
        }
        body { font-family: 'Google Sans', 'Roboto', sans-serif; background: var(--lighter-gray); color: var(--black); line-height: 1.6; }
        .top-nav { position: fixed; top: 0; left: 0; right: 0; height: 64px; background: var(--white); border-bottom: 1px solid var(--light-gray); display: flex; align-items: center; padding: 0 24px; z-index: 100; }
        .nav-left { display: flex; align-items: center; gap: 8px; }
        .logo { font-size: 22px; font-weight: 500; color: var(--black); text-decoration: none; }
        .logo span { color: var(--medium-gray); }
        .nav-center { flex: 1; display: flex; justify-content: center; gap: 8px; }
        .nav-link { padding: 8px 16px; color: var(--dark-gray); text-decoration: none; font-size: 14px; font-weight: 500; border-radius: 4px; }
        .nav-link:hover { background: var(--lighter-gray); }
        .nav-link.active { color: var(--primary); }
        .nav-right { display: flex; align-items: center; gap: 12px; }
        .btn { padding: 8px 20px; border-radius: 4px; font-size: 14px; font-weight: 500; cursor: pointer; text-decoration: none; border: none; transition: all 0.2s; }
        .btn-primary { background: var(--black); color: var(--white); }
        .btn-primary:hover { background: var(--dark-gray); }
        .btn-secondary { background: var(--white); color: var(--black); border: 1px solid var(--light-gray); }
        .btn-secondary:hover { background: var(--lighter-gray); }
        .main-content { margin-top: 64px; padding: 48px 32px; max-width: 1200px; margin-left: auto; margin-right: auto; }
        h1 { font-size: 36px; font-weight: 400; text-align: center; margin-bottom: 8px; }
        .subtitle { text-align: center; color: var(--medium-gray); font-size: 18px; margin-bottom: 48px; font-style: italic; }

        /* Pricing Grid */
        .pricing-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-bottom: 48px; }
        .pricing-card { background: var(--white); border: 1px solid var(--light-gray); border-radius: 12px; padding: 32px; position: relative; }
        .pricing-card.featured { border: 2px solid var(--black); }
        .pricing-card.featured::before { content: 'Popular'; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--black); color: var(--white); padding: 4px 16px; border-radius: 12px; font-size: 12px; font-weight: 500; }
        .pricing-tier { font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--medium-gray); margin-bottom: 16px; }
        .pricing-price { margin-bottom: 16px; }
        .pricing-amount { font-size: 48px; font-weight: 500; color: var(--black); }
        .pricing-period { font-size: 16px; color: var(--medium-gray); }
        .pricing-desc { color: var(--medium-gray); font-size: 14px; margin-bottom: 24px; }
        .pricing-features { margin-bottom: 32px; }
        .pricing-feature { display: flex; align-items: center; gap: 12px; padding: 8px 0; font-size: 14px; color: var(--dark-gray); }
        .pricing-feature svg { color: var(--success); flex-shrink: 0; }
        .pricing-cta { width: 100%; padding: 14px; text-align: center; display: block; }
        .btn-disabled { opacity: 0.5; cursor: not-allowed; pointer-events: none; }

        /* Enterprise Card */
        .enterprise-card { background: var(--white); border: 1px solid var(--light-gray); border-radius: 12px; padding: 48px; text-align: center; margin-bottom: 48px; }
        .enterprise-card h3 { font-size: 24px; font-weight: 500; margin-bottom: 12px; }
        .enterprise-card p { color: var(--medium-gray); margin-bottom: 24px; }
        .enterprise-features { display: flex; flex-wrap: wrap; justify-content: center; gap: 16px; margin-bottom: 32px; color: var(--medium-gray); font-size: 14px; }

        /* Comparison Table */
        .comparison-section { background: var(--white); border: 1px solid var(--light-gray); border-radius: 12px; padding: 32px; margin-bottom: 48px; }
        .comparison-section h2 { font-size: 24px; font-weight: 500; text-align: center; margin-bottom: 32px; }
        .comparison-table { width: 100%; border-collapse: collapse; }
        .comparison-table th, .comparison-table td { padding: 16px; text-align: left; border-bottom: 1px solid var(--lighter-gray); }
        .comparison-table th { font-weight: 500; color: var(--dark-gray); background: var(--lighter-gray); }
        .comparison-table th:not(:first-child), .comparison-table td:not(:first-child) { text-align: center; }
        .comparison-table td { font-size: 14px; color: var(--dark-gray); }
        .check { color: var(--success); }
        .dash { color: var(--light-gray); }

        /* Notes */
        .notes { text-align: center; max-width: 600px; margin: 0 auto 48px; }
        .note-item { display: flex; align-items: center; justify-content: center; gap: 8px; color: var(--dark-gray); font-size: 14px; margin-bottom: 12px; }
        .note-item svg { color: var(--success); }

        /* Footer */
        .footer { padding: 32px; border-top: 1px solid var(--light-gray); background: var(--white); text-align: center; }
        .footer a { color: var(--medium-gray); text-decoration: none; margin: 0 12px; font-size: 14px; }
        .footer p { font-size: 12px; color: var(--medium-gray); margin-top: 16px; }

        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--white); border-radius: 12px; padding: 32px; max-width: 400px; width: 90%; position: relative; }
        .modal-close { position: absolute; top: 16px; right: 16px; background: none; border: none; cursor: pointer; font-size: 24px; }
        .modal h3 { margin-bottom: 24px; }
        .modal input { width: 100%; padding: 12px; border: 1px solid var(--light-gray); border-radius: 8px; font-size: 16px; margin-bottom: 16px; }
        .modal .btn { width: 100%; padding: 14px; margin-bottom: 12px; }
        .modal p { text-align: center; font-size: 14px; color: var(--medium-gray); }
        .modal a { color: var(--black); font-weight: 500; }

        @media (max-width: 768px) { .nav-center { display: none; } .pricing-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-left"><a href="index.html" class="logo">Larun<span>.</span></a></div>
        <div class="nav-center">
            <a href="index.html" class="nav-link">Home</a>
            <a href="dashboard.html" class="nav-link">Dashboard</a>
            <a href="pricing.html" class="nav-link active">Pricing</a>
            <a href="docs.html" class="nav-link">Docs</a>
            <a href="download.html" class="nav-link">Download</a>
        </div>
        <div class="nav-right"><a href="dashboard.html" class="btn btn-primary">Get Started</a></div>
    </nav>

    <main class="main-content">
        <h1>Pricing</h1>
        <p class="subtitle">"The stars belong to everyone. Now, so does the science."</p>

        <div class="pricing-grid">
            <!-- Explorer (Free) -->
            <div class="pricing-card">
                <div class="pricing-tier">Explorer</div>
                <div class="pricing-price">
                    <span class="pricing-amount">Free</span>
                </div>
                <p class="pricing-desc">Perfect for getting started with exoplanet discovery</p>
                <div class="pricing-features">
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>10 targets per month</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>Basic CLI access</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>TinyML detection</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>Community support</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>TESS data access</span>
                    </div>
                </div>
                <a href="dashboard.html" class="btn btn-secondary pricing-cta">Get Started</a>
            </div>

            <!-- Researcher -->
            <div class="pricing-card featured">
                <div class="pricing-tier">Researcher</div>
                <div class="pricing-price">
                    <span class="pricing-amount">$9</span>
                    <span class="pricing-period">/month</span>
                </div>
                <p class="pricing-desc">For serious amateur astronomers and students</p>
                <div class="pricing-features">
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>Unlimited targets</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>BLS periodogram analysis</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>Transit parameter fitting</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>1,000 API calls/month</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>Priority support</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>Export reports (PDF)</span>
                    </div>
                </div>
                <button class="btn btn-primary pricing-cta" onclick="subscribe('researcher')">Subscribe</button>
            </div>

            <!-- Scientist -->
            <div class="pricing-card">
                <div class="pricing-tier">Scientist</div>
                <div class="pricing-price">
                    <span class="pricing-amount">$29</span>
                    <span class="pricing-period">/month</span>
                </div>
                <p class="pricing-desc">Full power for professional researchers</p>
                <div class="pricing-features">
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>Everything in Researcher</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>Multi-mission data (TESS + Kepler)</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>Unlimited API access</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>JWST spectroscopy data</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>TTV analysis</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>Publication templates</span>
                    </div>
                    <div class="pricing-feature">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                        <span>Direct researcher support</span>
                    </div>
                </div>
                <button class="btn btn-primary pricing-cta" onclick="subscribe('scientist')">Subscribe</button>
            </div>
        </div>

        <!-- Enterprise Card -->
        <div class="enterprise-card">
            <h3>Enterprise</h3>
            <p>Custom solutions for universities, observatories, and research institutions</p>
            <div class="enterprise-features">
                <span>White-labeling</span>
                <span>On-premise deployment</span>
                <span>Volume licensing</span>
                <span>Custom integrations</span>
            </div>
            <a href="mailto:enterprise@larun.space" class="btn btn-secondary">Contact Sales</a>
        </div>

        <!-- Comparison Table -->
        <div class="comparison-section">
            <h2>Feature Comparison</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Explorer</th>
                        <th>Researcher</th>
                        <th>Scientist</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Targets per month</td><td>10</td><td>Unlimited</td><td>Unlimited</td></tr>
                    <tr><td>TinyML Detection</td><td class="check">&#10003;</td><td class="check">&#10003;</td><td class="check">&#10003;</td></tr>
                    <tr><td>BLS Periodogram</td><td class="dash">&mdash;</td><td class="check">&#10003;</td><td class="check">&#10003;</td></tr>
                    <tr><td>Transit Fitting</td><td class="dash">&mdash;</td><td class="check">&#10003;</td><td class="check">&#10003;</td></tr>
                    <tr><td>API Access</td><td class="dash">&mdash;</td><td>1,000/mo</td><td>Unlimited</td></tr>
                    <tr><td>Kepler Data</td><td class="dash">&mdash;</td><td class="dash">&mdash;</td><td class="check">&#10003;</td></tr>
                    <tr><td>JWST Data</td><td class="dash">&mdash;</td><td class="dash">&mdash;</td><td class="check">&#10003;</td></tr>
                    <tr><td>TTV Analysis</td><td class="dash">&mdash;</td><td class="dash">&mdash;</td><td class="check">&#10003;</td></tr>
                    <tr><td>PDF Reports</td><td class="dash">&mdash;</td><td class="check">&#10003;</td><td class="check">&#10003;</td></tr>
                    <tr><td>Support</td><td>Community</td><td>Priority</td><td>Direct</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Notes -->
        <div class="notes">
            <div class="note-item">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                <span>Core tools always free for research & education</span>
            </div>
            <div class="note-item">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                <span>BSL-1.1 &rarr; MIT License after 4 years</span>
            </div>
            <div class="note-item">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                <span>Cancel anytime, no questions asked</span>
            </div>
        </div>
    </main>

    <footer class="footer">
        <a href="https://laruneng.com" target="_blank">laruneng.com</a>
        <a href="https://github.com/Paddy1981/larun" target="_blank">GitHub</a>
        <a href="docs.html">Documentation</a>
        <a href="download.html">Download</a>
        <p>&copy; 2026 Larun. AstroTinyML. All rights reserved.</p>
    </footer>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="auth-modal">
        <div class="modal">
            <button class="modal-close" onclick="closeAuthModal()">&times;</button>
            <h3 id="auth-modal-title">Sign In</h3>
            <form onsubmit="handleAuth(event)">
                <input type="email" id="auth-email" placeholder="Email" required>
                <input type="password" id="auth-password" placeholder="Password" required>
                <button type="submit" class="btn btn-primary" id="auth-submit-text">Sign In</button>
            </form>
            <button class="btn btn-secondary" onclick="handleGitHubLogin()" style="background: #24292e; color: white; border: none;">Continue with GitHub</button>
            <p style="margin-top: 16px;">
                <span id="auth-toggle-text">Don't have an account?</span>
                <a href="#" onclick="toggleAuthMode(); return false;" id="auth-toggle-link">Sign Up</a>
            </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/auth.js"></script>
    <script>
        const DEMO_MODE = true;

        async function subscribe(tier) {
            if (!Auth.isAuthenticated || !Auth.user) {
                openAuthModal('signup', window.location.href);
                sessionStorage.setItem('pending_subscription', tier);
                return;
            }

            const btn = event?.target;
            const originalText = btn?.textContent;
            if (btn) {
                btn.disabled = true;
                btn.textContent = 'Processing...';
            }

            try {
                const response = await fetch('https://mwmbcfcvnkwegrjlauis.supabase.co/functions/v1/create-checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${Auth.session?.access_token || ''}`
                    },
                    body: JSON.stringify({
                        tier: tier,
                        user_id: Auth.user.id,
                        user_email: Auth.user.email,
                        success_url: window.location.origin + '/dashboard.html?subscription=success&tier=' + tier,
                        cancel_url: window.location.origin + '/pricing.html?subscription=cancelled'
                    })
                });

                const data = await response.json();

                if (response.ok && data.url) {
                    window.location.href = data.url;
                    return;
                }

                if (DEMO_MODE || data.error === 'Payment system not configured') {
                    if (confirm(`Demo Mode: Subscribe to ${tier.charAt(0).toUpperCase() + tier.slice(1)} plan ($${tier === 'researcher' ? '9' : '29'}/month)?`)) {
                        activateSubscription(tier);
                    }
                } else {
                    throw new Error(data.error || 'Checkout failed');
                }
            } catch (error) {
                console.error('Subscription error:', error);
                if (DEMO_MODE) {
                    if (confirm(`Activate ${tier.charAt(0).toUpperCase() + tier.slice(1)} plan in demo mode?`)) {
                        activateSubscription(tier);
                    }
                } else {
                    alert(`Payment processing unavailable. Please contact support@larun.space to subscribe.`);
                }
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.textContent = originalText;
                }
            }
        }

        function activateSubscription(tier) {
            localStorage.setItem('user_tier', tier);
            try {
                const cached = localStorage.getItem('larun-user-cache');
                if (cached) {
                    const data = JSON.parse(cached);
                    data.tier = tier;
                    localStorage.setItem('larun-user-cache', JSON.stringify(data));
                }
            } catch (e) {}
            const tierNames = { researcher: 'Researcher', scientist: 'Scientist' };
            alert(`Welcome to the ${tierNames[tier]} plan! Your subscription is now active.`);
            window.location.href = 'dashboard.html?subscription=success&tier=' + tier;
        }

        function updateSubscriptionUI() {
            const currentTier = localStorage.getItem('user_tier') || 'free';
            document.querySelectorAll('.pricing-cta').forEach(btn => {
                const card = btn.closest('.pricing-card');
                const tierName = card?.querySelector('.pricing-tier')?.textContent?.toLowerCase();
                if (tierName === currentTier || (currentTier === 'free' && tierName === 'explorer')) {
                    btn.textContent = 'Current Plan';
                    btn.disabled = true;
                    btn.classList.add('btn-disabled');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateSubscriptionUI();
            const checkPendingSubscription = setInterval(() => {
                if (Auth.isAuthenticated) {
                    const pendingTier = sessionStorage.getItem('pending_subscription');
                    if (pendingTier) {
                        sessionStorage.removeItem('pending_subscription');
                        setTimeout(() => subscribe(pendingTier), 500);
                    }
                    clearInterval(checkPendingSubscription);
                    updateSubscriptionUI();
                }
            }, 500);
            setTimeout(() => clearInterval(checkPendingSubscription), 10000);
        });
    </script>
</body>
</html>
